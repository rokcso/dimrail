// Cloudflare Workers for Dimrail Config
// Auto-generated by generate.py

export default {
  async fetch(request) {
    const url = new URL(request.url);

    // 访问验证 - 请修改为你自己的密钥
    const SECRET_TOKEN = "YOUR_SECRET_TOKEN_HERE";

    // 检查 token 参数
    const token = url.searchParams.get("token");
    if (token !== SECRET_TOKEN) {
      const infoPage = `
██████╗  ██╗ ███╗   ███╗ ██████╗   █████╗  ██╗ ██╗
██╔══██╗ ██║ ████╗ ████║ ██╔══██╗ ██╔══██╗ ██║ ██║
██║  ██║ ██║ ██╔████╔██║ ██████╔╝ ███████║ ██║ ██║
██║  ██║ ██║ ██║╚██╔╝██║ ██╔══██╗ ██╔══██║ ██║ ██║
██████╔╝ ██║ ██║ ╚═╝ ██║ ██║  ██║ ██║  ██║ ██║ ███████╗
╚═════╝  ╚═╝ ╚═╝     ╚═╝ ╚═╝  ╚═╝ ╚═╝  ╚═╝ ╚═╝ ╚══════╝

Dimrail - Stash Proxy Configuration

This is a private Stash configuration service.
Access requires a valid token.

Usage:
  ${url.origin}/?token=your-secret-token

Project:
  https://github.com/rokcso/dimrail

Error: Unauthorized - Invalid or missing token
`;
      return new Response(infoPage, {
        status: 401,
        headers: {
          "Content-Type": "text/plain; charset=utf-8",
        },
      });
    }

    // 配置内容（由生成脚本自动填充）
    const config = `{{CONFIG_CONTENT}}`;

    // 返回配置
    return new Response(config, {
      status: 200,
      headers: {
        "Content-Type": "text/yaml; charset=utf-8",
        "Access-Control-Allow-Origin": "*",
        "Cache-Control": "public, max-age=300", // 缓存5分钟
      },
    });
  },
};
